<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndoT5 Hybrid Paraphraser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .method-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .method-option {
            flex: 1;
            min-width: 150px;
        }

        .method-option input[type="radio"] {
            display: none;
        }

        .method-option label {
            display: block;
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0;
        }

        .method-option input[type="radio"]:checked + label {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .method-option label:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .method-option input[type="radio"]:checked + label:hover {
            background: #5a6fd8;
        }

        .settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
        }

        .setting-item label {
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .setting-item input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }

        .setting-item input:focus {
            outline: none;
            border-color: #667eea;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 1.1em;
            font-weight: 500;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        .loading-details {
            margin-top: 10px;
            font-size: 0.9em;
            color: #999;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .result-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .result-item h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .result-text {
            font-size: 1.05em;
            line-height: 1.6;
            color: #555;
        }

        .quality-score {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .score-bar {
            width: 100px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b 0%, #ffd93d 50%, #6bcf7f 100%);
            transition: width 0.3s ease;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        /* File Upload Styles */
        .file-upload-section {
            margin-top: 15px;
            padding: 20px;
            border: 2px dashed #e0e0e0;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .file-upload-section:hover {
            border-color: #667eea;
            background: #f5f5ff;
        }

        .file-upload-section.drag-over {
            border-color: #667eea;
            background: #eff0ff;
        }

        .file-input {
            display: none;
        }

        .file-upload-label {
            cursor: pointer;
            color: #667eea;
            font-weight: 600;
        }

        .file-upload-label:hover {
            text-decoration: underline;
        }

        .file-info {
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 8px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-info .filename {
            font-weight: 600;
            color: #2e7d32;
        }

        .file-info .file-stats {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .chunk-progress {
            margin-top: 15px;
            display: none;
        }

        .chunk-progress.show {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .text-preview {
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9em;
            color: #555;
            border: 1px solid #e0e0e0;
            display: none;
        }

        .text-preview.show {
            display: block;
        }

        .clear-file-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .clear-file-btn:hover {
            background: #d32f2f;
        }

        .or-divider {
            margin: 15px 0;
            text-align: center;
            color: #999;
            position: relative;
        }

        .or-divider::before,
        .or-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: #e0e0e0;
        }

        .or-divider::before {
            left: 0;
        }

        .or-divider::after {
            right: 0;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }
            
            .method-selector {
                flex-direction: column;
            }
            
            .settings {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>IndoT5 Hybrid Paraphraser</h1>
            <p>Sistem parafrase bahasa Indonesia dengan teknologi neural dan rule-based</p>
        </div>

        <div class="main-content">
            <form id="paraphraseForm">
                <div class="form-group">
                    <label for="inputText">Masukkan teks yang ingin diparafrase:</label>
                    <textarea id="inputText" placeholder="Contoh: Saya sedang belajar bahasa Indonesia dengan antusias." required></textarea>
                    
                    <div class="or-divider">atau</div>
                    
                    <div class="file-upload-section" id="dropZone">
                        <input type="file" id="fileInput" class="file-input" accept=".pdf,.txt">
                        <p>ðŸ“„ Drag & drop file di sini, atau <label for="fileInput" class="file-upload-label">pilih file</label></p>
                        <p style="font-size: 0.85em; color: #888; margin-top: 5px;">Format: PDF, TXT (Maks. 16MB)</p>
                    </div>
                    
                    <div class="file-info" id="fileInfo">
                        <span class="filename" id="fileName"></span>
                        <div class="file-stats" id="fileStats"></div>
                        <button type="button" class="clear-file-btn" id="clearFileBtn">âœ• Hapus File</button>
                    </div>
                    
                    <div class="text-preview" id="textPreview"></div>
                    
                    <div class="chunk-progress" id="chunkProgress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">Memproses chunk 0/0...</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Pilih metode parafrase:</label>
                    <div class="method-selector">
                        <div class="method-option">
                            <input type="radio" id="hybrid" name="method" value="hybrid" checked>
                            <label for="hybrid">
                                <strong>Hybrid</strong><br>
                                <small>Neural + Rule-based</small>
                            </label>
                        </div>
                        <div class="method-option">
                            <input type="radio" id="neural" name="method" value="neural">
                            <label for="neural">
                                <strong>Neural</strong><br>
                                <small>IndoT5 saja</small>
                            </label>
                        </div>
                        <div class="method-option">
                            <input type="radio" id="rule-based" name="method" value="rule-based">
                            <label for="rule-based">
                                <strong>Rule-based</strong><br>
                                <small>Transformasi aturan</small>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Pengaturan:</label>
                    <div class="settings">
                        <div class="setting-item">
                            <label for="numVariations">Jumlah variasi:</label>
                            <input type="number" id="numVariations" min="1" max="10" value="5">
                        </div>
                        <div class="setting-item">
                            <label for="minQuality">Kualitas minimum (%):</label>
                            <input type="number" id="minQuality" min="0" max="100" step="5" value="70">
                        </div>
                        <div class="setting-item">
                            <label for="maxLength">Panjang maksimum:</label>
                            <input type="number" id="maxLength" min="10" max="1000" value="200">
                        </div>
                        <div class="setting-item">
                            <label for="temperature">Temperature:</label>
                            <input type="number" id="temperature" min="0.1" max="2.0" step="0.1" value="1.0">
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    Parafrase Teks
                </button>
            </form>

            <div class="loading" id="loading">
                Memproses teks...
            </div>

            <div class="error" id="error"></div>

            <div class="results" id="results"></div>
        </div>
    </div>

    <script>
        // File upload state
        let uploadedChunks = [];
        let uploadedText = '';
        
        // File Upload Handling
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileStats = document.getElementById('fileStats');
        const textPreview = document.getElementById('textPreview');
        const clearFileBtn = document.getElementById('clearFileBtn');
        const inputText = document.getElementById('inputText');
        const chunkProgress = document.getElementById('chunkProgress');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        
        // Drag and drop events
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });
        
        // File input change
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        // Clear file button
        clearFileBtn.addEventListener('click', () => {
            clearUploadedFile();
        });
        
        function clearUploadedFile() {
            uploadedChunks = [];
            uploadedText = '';
            fileInput.value = '';
            fileInfo.classList.remove('show');
            textPreview.classList.remove('show');
            chunkProgress.classList.remove('show');
            inputText.required = true;
            inputText.value = '';
        }
        
        async function handleFileUpload(file) {
            const error = document.getElementById('error');
            error.style.display = 'none';
            
            // Validate file type
            const allowedTypes = ['application/pdf', 'text/plain'];
            const allowedExtensions = ['.pdf', '.txt'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!allowedExtensions.includes(fileExtension)) {
                error.textContent = 'Format file tidak didukung. Gunakan PDF atau TXT.';
                error.style.display = 'block';
                return;
            }
            
            // Validate file size (16MB)
            if (file.size > 16 * 1024 * 1024) {
                error.textContent = 'Ukuran file terlalu besar. Maksimal 16MB.';
                error.style.display = 'block';
                return;
            }
            
            // Show loading
            fileName.textContent = 'ðŸ“„ Mengupload: ' + file.name;
            fileStats.textContent = 'Mengekstrak teks...';
            fileInfo.classList.add('show');
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMsg = 'Gagal mengupload file';
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMsg = errorData.error || errorMsg;
                    } catch (e) {
                        errorMsg = errorText || errorMsg;
                    }
                    throw new Error(errorMsg);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Store chunks for later processing
                    uploadedChunks = data.chunks || [];
                    uploadedText = data.text || '';
                    
                    // Update UI
                    fileName.textContent = 'âœ… ' + file.name;
                    
                    let statsText = `${data.character_count.toLocaleString()} karakter`;
                    if (data.metadata.pages) {
                        statsText += ` | ${data.metadata.pages} halaman`;
                    }
                    if (data.chunk_count > 1) {
                        statsText += ` | ${data.chunk_count} chunk`;
                    }
                    fileStats.textContent = statsText;
                    
                    // Show text preview
                    const previewText = uploadedText.substring(0, 500);
                    textPreview.textContent = previewText + (uploadedText.length > 500 ? '...' : '');
                    textPreview.classList.add('show');
                    
                    // Put first chunk or full text in textarea
                    if (uploadedChunks.length > 0) {
                        inputText.value = uploadedChunks[0];
                    } else {
                        inputText.value = uploadedText;
                    }
                    inputText.required = false;
                    
                } else {
                    throw new Error(data.error || 'Gagal mengekstrak teks dari file');
                }
                
            } catch (err) {
                error.textContent = err.message;
                error.style.display = 'block';
                clearUploadedFile();
            }
        }
        
        // Form submit handler
        document.getElementById('paraphraseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const error = document.getElementById('error');
            
            // Hide previous results/errors
            results.style.display = 'none';
            error.style.display = 'none';
            
            // Show loading with estimate
            const numVars = parseInt(document.getElementById('numVariations').value) || 3;
            const estimatedTime = numVars * 4; // ~4s per variation (improved quality)
            loading.innerHTML = `ðŸ”„ Memproses parafrase... (estimasi ${estimatedTime}-${estimatedTime+8} detik)<div class="loading-details">Menggunakan AI IndoT5 dengan semantic analysis untuk ${numVars} variasi berkualitas tinggi</div>`;
            loading.style.display = 'block';
            submitBtn.disabled = true;
            
            const method = document.querySelector('input[name="method"]:checked').value;
            
            try {
                // Check if we have multiple chunks to process
                if (uploadedChunks.length > 1) {
                    // Process chunks
                    chunkProgress.classList.add('show');
                    
                    const response = await fetch('/paraphrase-chunks', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chunks: uploadedChunks,
                            method: method
                        })
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        let errorMsg = 'Gagal memproses chunks';
                        try {
                            const errorData = JSON.parse(errorText);
                            errorMsg = errorData.error || errorMsg;
                        } catch (e) {
                            errorMsg = errorText || errorMsg;
                        }
                        throw new Error(errorMsg);
                    }
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        displayChunkResults(data);
                    } else {
                        throw new Error(data.error || 'Gagal memproses chunks');
                    }
                    
                } else {
                    // Normal single text processing
                    const formData = {
                        text: document.getElementById('inputText').value,
                        method: method,
                        num_variations: parseInt(document.getElementById('numVariations').value),
                        min_quality: parseFloat(document.getElementById('minQuality').value),
                        max_length: parseInt(document.getElementById('maxLength').value),
                        temperature: parseFloat(document.getElementById('temperature').value)
                    };
                    
                    const response = await fetch('/paraphrase', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        let errorMsg = 'Terjadi kesalahan';
                        try {
                            const errorData = JSON.parse(errorText);
                            errorMsg = errorData.error || errorMsg;
                        } catch (e) {
                            errorMsg = errorText || errorMsg;
                        }
                        throw new Error(errorMsg);
                    }
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        displayResults(data);
                    } else {
                        throw new Error(data.error || 'Terjadi kesalahan');
                    }
                }
            } catch (err) {
                error.textContent = err.message;
                error.style.display = 'block';
            } finally {
                loading.style.display = 'none';
                chunkProgress.classList.remove('show');
                submitBtn.disabled = false;
            }
        });
        
        function displayChunkResults(data) {
            const results = document.getElementById('results');
            results.innerHTML = '';
            
            // Show combined result first
            const combinedItem = document.createElement('div');
            combinedItem.className = 'result-item';
            combinedItem.innerHTML = `
                <h3>ðŸ“„ Hasil Parafrase Lengkap</h3>
                <div class="result-text">${data.combined_text}</div>
                <div class="quality-score">
                    <span>Rata-rata Kualitas:</span>
                    <div class="score-bar">
                        <div class="score-fill" style="width: ${Math.round(data.average_quality)}%"></div>
                    </div>
                    <span>${Math.round(data.average_quality)}%</span>
                </div>
                <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    âœ… ${data.chunks_processed} chunk berhasil diproses
                </p>
            `;
            results.appendChild(combinedItem);
            
            // Show individual chunks (collapsed by default)
            if (data.chunk_results && data.chunk_results.length > 1) {
                const detailsContainer = document.createElement('details');
                detailsContainer.style.marginTop = '15px';
                detailsContainer.innerHTML = `
                    <summary style="cursor: pointer; color: #667eea; font-weight: 600;">
                        Lihat detail per-chunk (${data.chunk_results.length} chunk)
                    </summary>
                `;
                
                data.chunk_results.forEach((chunk, index) => {
                    const chunkItem = document.createElement('div');
                    chunkItem.className = 'result-item';
                    chunkItem.style.marginTop = '10px';
                    chunkItem.innerHTML = `
                        <h3>Chunk ${index + 1}</h3>
                        <p style="font-size: 0.85em; color: #888; margin-bottom: 8px;"><strong>Original:</strong> ${chunk.original.substring(0, 100)}...</p>
                        <div class="result-text">${chunk.paraphrased}</div>
                        <div class="quality-score">
                            <span>Kualitas:</span>
                            <div class="score-bar">
                                <div class="score-fill" style="width: ${Math.round(chunk.quality_score)}%"></div>
                            </div>
                            <span>${Math.round(chunk.quality_score)}%</span>
                        </div>
                    `;
                    detailsContainer.appendChild(chunkItem);
                });
                
                results.appendChild(detailsContainer);
            }
            
            results.style.display = 'block';
        }
        
        function displayResults(data) {
            const results = document.getElementById('results');
            results.innerHTML = '';
            
            if (data.paraphrases && data.paraphrases.length > 0) {
                data.paraphrases.forEach((item, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    
                    // quality_score sudah dalam skala 0-100 dari backend
                    const qualityScore = item.quality_score || 0;
                    const scorePercentage = Math.round(qualityScore);
                    
                    resultItem.innerHTML = `
                        <h3>Variasi ${index + 1}</h3>
                        <div class="result-text">${item.text}</div>
                        <div class="quality-score">
                            <span>Kualitas:</span>
                            <div class="score-bar">
                                <div class="score-fill" style="width: ${scorePercentage}%"></div>
                            </div>
                            <span>${scorePercentage}%</span>
                        </div>
                    `;
                    
                    results.appendChild(resultItem);
                });
            } else {
                results.innerHTML = '<div class="result-item"><h3>Tidak ada hasil</h3><div class="result-text">Tidak dapat menghasilkan parafrase untuk teks ini.</div></div>';
            }
            
            results.style.display = 'block';
        }
        
        // Add example text on page load
        document.addEventListener('DOMContentLoaded', function() {
            const examples = [
                'Saya sedang belajar bahasa Indonesia dengan penuh semangat.',
                'Teknologi artificial intelligence berkembang sangat pesat di era digital ini.',
                'Pendidikan merupakan kunci utama untuk membangun masa depan yang cerah.',
                'Kebudayaan Indonesia sangat beragam dan kaya akan tradisi.',
                'Pelestarian lingkungan hidup menjadi tanggung jawab kita bersama.'
            ];
            
            const inputText = document.getElementById('inputText');
            inputText.placeholder = examples[Math.floor(Math.random() * examples.length)];
        });
    </script>
</body>
</html> 
